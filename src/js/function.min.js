$(function(){function t(t){if(""===$(".autocompleteList").val())return $(".autocompleteList").remove(),void $(".modalList").remove();$(".autocompleteList").length||$(".l-autocomplete").append('<ul class="autocompleteList padding-all-1em"></ul>');let e="";t.items.map(t=>{let a,s=t.name,n=t.id,o=t.images;if(o.length){let t=o[1].url;a=`<li class="artistItems action" data-artist_id="${n}"><image class="l-searchArtistImage artistImage" src="${t}"><div class="l-artistInfo"><span class="searchArtistName font-wb">${s}</span></div></li>`}else a=`\n                <li class="artistItems action" data-artist_id="${n}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="l-searchArtistImage artistImage"><!--!Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L353.3 251.6C407.9 237 448 187.2 448 128C448 57.3 390.7 0 320 0C250.2 0 193.5 55.8 192 125.2L38.8 5.1zM264.3 304.3C170.5 309.4 96 387.2 96 482.3c0 16.4 13.3 29.7 29.7 29.7l388.6 0c3.9 0 7.6-.7 11-2.1l-261-205.6z"/></svg><div class="l-artistInfo"><span class="searchArtistName font-wb">${s}</span></div></li>`;e+=a}),$(".autocompleteList").append(e)}function e(t){let e=$(".albumArtList").find("li");var a=[];e.each(function(){a.push($(this).attr("id"))}),$(".modal-content").hasClass("modalList")||$(".modal-content").append('<ul class="modalList"></ul >');let s="";t.items.map(t=>{let e=t.images[1].url,n=t.name,o=t.release_date.substring(0,4),i=t.id,l=t.artists.map(t=>t.name).join(", "),c=a.includes(i),r=c?"bg-orange":"bg-turquoise",m=c?"selected":"select",u=c?"選択中":"選択";s+=`\n                <li class="albumItems" id="${i}" data-name="${n}" data-artist="${l}">\n                    <img class="albumImage" src="${e}">\n                        <div class="l-albumInfo">\n                            <span class="albumName">${n} (${o})</span>\n                            <span class="artistsName">${l}</span>\n                        </div>\n                        <button class="l-button txt-white ${r} ${m} action">${u}</button>\n                    </li>`}),$(".modalList").append(s)}$(document).on("click",".startButton",function(){$(".startText").toggleClass("fadeIn fadeOut"),setTimeout(()=>{$(".startText").toggleClass("disp-block disp-none"),$(".l-albumList").toggleClass("disp-none disp-block")},1e3)});var a=$(".addButton"),s=$(".modal-close"),n=$(".modal-container"),o=$("#artistName"),i=$(".reset"),l=10;let c;a.on("click",function(){return n.addClass("active"),$(".modalList").remove(),$(".autocompleteList").remove(),o.val(""),o.attr("data-artist_id",""),$("#choiceCounter").text(l),!1}),s.on("click",function(){n.removeClass("active")});const r=300;o.on("input",function(){$(".autocompleteList").remove();let e=o.val();clearTimeout(c),c=setTimeout(()=>{$.ajax({url:"./js/ajax/searchArtists.php",cache:!1,type:"GET",dataType:"json",data:{artistName:e}}).done(function(e){$(".modalList").remove(),t(e)}).fail(function(){$(".autocompleteList").append('<li class="artistItems">アーティストが見つかりませんでした</li>')})},r)}),$(document).on("click",".artistItems",function(){const t=$(this);o.val(t.text()),o.attr("data-artist_id",t.attr("data-artist_id")),$(".autocompleteList").remove(),$(".search").trigger("click")}),$(".search").on("click",function(){$(".autocompleteList").remove(),$(".modalList").remove(),$(".modalList").children().remove();let t=o.val(),a=$("[name=typeLabel]:checked").val(),s=o.attr("data-artist_id");$.ajax({url:"./js/ajax/searchSpotify.php",cache:!1,type:"GET",dataType:"json",data:{artistName:t,type:a,artistId:s}}).done(function(t){$("modalList").remove(),$("searchForm").addClass("m-bottom-2em"),e(t)}).fail(function(){$(".modalList").append('<li class="albumItems">データの取得に失敗しました</li>')})}),$("[name=typeLabel]").on("click",function(){$(".search").trigger("click")}),$(".clear").on("click",function(){o.val(""),o.attr("data-artist_id",""),$(".autocompleteList").remove()}),$(document).on("click",".select",function(){l--,$("#choiceCounter").text(l);let t=$(this),e=t.parent(),s=e.attr("id"),o=e.attr("data-name"),i=e.attr("data-artist"),c=e.find("img").attr("src");t.text("選択中"),t.toggleClass("select selected"),t.toggleClass("bg-turquoise bg-orange"),$(".albumArtList").append(`\n            <li class="albumListItem action" id="${s}">\n            <image class="l-albumArt m-bottom-05em" src="${c}">\n            <span class="selectName">${o}</span><span>${i}</span>\n            </li>`),10===$(".albumListItem").length&&(a.toggleClass("disp-block disp-none"),n.removeClass("active"),1==!$(".resetWrapper").length&&($(".resetArea").append('\n                    <div class="ta-center resetWrapper">\n                        <button class="l-button action m-right-1em txt-white bg-turquoise reset action">\n                            <i class="fa-solid fa-rotate-right"></i>\n                        </button>\n                        <button class="l-button txt-white bg-turquoise capture action">\n                            <i class="fa-solid fa-camera"></i>\n                        </button>\n                    </div>'),$(".modal-container").removeClass("active")))}),$(document).on({mouseenter:function(){$(this).append('<span class="albumRemove"><i class="fa-solid fa-xmark"></i></span>')},mouseleave:function(){$(this).find(".albumRemove").remove()}},".albumListItem"),$(document).on("click",".albumRemove",function(){$(this).parent().remove();const t=$(".albumListItem").length;9===t&&(a.removeClass("disp-none"),a.addClass("disp-block")),l++,$("#choiceCounter").text(l),i.removeClass("disp-none")}),$(document).on("click",".selected",function(){const t=$(this);l++,$("#choiceCounter").text(l),t.text("選択"),t.toggleClass("select selected"),t.toggleClass("bg-turquoise bg-orange");let e=t.parent().attr("id");$("#"+e).remove()}),$(document).on("click",".reset",function(){l=10,$("#choiceCounter").text("10"),$(".albumArtList").empty(),a.hasClass("disp-none")&&a.toggleClass("disp-none disp-block"),$(".resetWrapper").remove()}),$(document).on("click",".capture",function(){html2canvas(document.querySelector(".l-contentWrapper"),{useCORS:!0}).then(t=>{var e=t.toDataURL("image/png");const a=m(e),s=new File([a],"image.png",{type:"image/png"});navigator.share({text:"共有",files:[s]}).then(()=>{console.log("success.")}).catch(t=>{console.log(t)})})});const m=t=>{const e=atob(t.replace(/^.*,/,"")),a=new Uint8Array(e.length);for(let t=0;t<e.length;t++)a[t]=e.charCodeAt(t);try{const t=new Blob([a.buffer],{type:"image/png"});return t}catch(t){return null}}});